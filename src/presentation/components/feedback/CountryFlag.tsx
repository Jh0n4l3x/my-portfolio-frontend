interface CountryFlagProps {
  countryCode: string;
  className?: string;
}

export function CountryFlag({ countryCode, className = '' }: CountryFlagProps) {
  // Convert phone code to ISO code (simplified mapping for common countries)
  const getISOCode = (phoneCode: string): string => {
    const codeMap: Record<string, string> = {
      '+1': 'us',
      '+52': 'mx',
      '+57': 'co',
      '+51': 'pe',
      '+54': 'ar',
      '+56': 'cl',
      '+58': 've',
      '+34': 'es',
      '+593': 'ec',
      '+591': 'bo',
      '+595': 'py',
      '+598': 'uy',
      '+507': 'pa',
      '+506': 'cr',
      '+503': 'sv',
      '+502': 'gt',
      '+504': 'hn',
      '+505': 'ni',
      '+55': 'br',
      '+501': 'bz',
      '+1-242': 'bs',
      '+1-246': 'bb',
      '+1-264': 'ai',
      '+1-268': 'ag',
      '+1-284': 'vg',
      '+1-340': 'vi',
      '+1-345': 'ky',
      '+1-441': 'bm',
      '+1-473': 'gd',
      '+1-649': 'tc',
      '+1-664': 'ms',
      '+1-721': 'sx',
      '+1-758': 'lc',
      '+1-767': 'dm',
      '+1-784': 'vc',
      '+1-809': 'do',
      '+1-868': 'tt',
      '+1-869': 'kn',
      '+1-876': 'jm',
      '+53': 'cu',
      '+509': 'ht',
      '+33': 'fr',
      '+351': 'pt',
      '+39': 'it',
      '+41': 'ch',
      '+43': 'at',
      '+49': 'de',
      '+32': 'be',
      '+31': 'nl',
      '+352': 'lu',
      '+377': 'mc',
      '+376': 'ad',
      '+44': 'gb',
      '+353': 'ie',
      '+45': 'dk',
      '+46': 'se',
      '+47': 'no',
      '+358': 'fi',
      '+354': 'is',
      '+48': 'pl',
      '+420': 'cz',
      '+421': 'sk',
      '+36': 'hu',
      '+40': 'ro',
      '+359': 'bg',
      '+7': 'ru',
      '+380': 'ua',
      '+375': 'by',
      '+373': 'md',
      '+30': 'gr',
      '+355': 'al',
      '+381': 'rs',
      '+382': 'me',
      '+383': 'xk',
      '+385': 'hr',
      '+386': 'si',
      '+387': 'ba',
      '+389': 'mk',
      '+370': 'lt',
      '+371': 'lv',
      '+372': 'ee',
      '+90': 'tr',
      '+971': 'ae',
      '+966': 'sa',
      '+972': 'il',
      '+962': 'jo',
      '+961': 'lb',
      '+963': 'sy',
      '+964': 'iq',
      '+98': 'ir',
      '+965': 'kw',
      '+968': 'om',
      '+974': 'qa',
      '+973': 'bh',
      '+967': 'ye',
      '+86': 'cn',
      '+81': 'jp',
      '+82': 'kr',
      '+850': 'kp',
      '+886': 'tw',
      '+852': 'hk',
      '+853': 'mo',
      '+976': 'mn',
      '+65': 'sg',
      '+60': 'my',
      '+62': 'id',
      '+63': 'ph',
      '+66': 'th',
      '+84': 'vn',
      '+95': 'mm',
      '+856': 'la',
      '+855': 'kh',
      '+673': 'bn',
      '+670': 'tl',
      '+91': 'in',
      '+92': 'pk',
      '+880': 'bd',
      '+94': 'lk',
      '+977': 'np',
      '+975': 'bt',
      '+960': 'mv',
      '+93': 'af',
      '+996': 'kg',
      '+992': 'tj',
      '+993': 'tm',
      '+998': 'uz',
      '+20': 'eg',
      '+213': 'dz',
      '+216': 'tn',
      '+218': 'ly',
      '+212': 'ma',
      '+249': 'sd',
      '+211': 'ss',
      '+234': 'ng',
      '+233': 'gh',
      '+225': 'ci',
      '+221': 'sn',
      '+223': 'ml',
      '+226': 'bf',
      '+227': 'ne',
      '+228': 'tg',
      '+229': 'bj',
      '+231': 'lr',
      '+232': 'sl',
      '+224': 'gn',
      '+245': 'gw',
      '+220': 'gm',
      '+238': 'cv',
      '+254': 'ke',
      '+255': 'tz',
      '+256': 'ug',
      '+250': 'rw',
      '+257': 'bi',
      '+251': 'et',
      '+252': 'so',
      '+253': 'dj',
      '+291': 'er',
      '+237': 'cm',
      '+236': 'cf',
      '+235': 'td',
      '+242': 'cg',
      '+243': 'cd',
      '+240': 'gq',
      '+241': 'ga',
      '+27': 'za',
      '+264': 'na',
      '+267': 'bw',
      '+268': 'sz',
      '+266': 'ls',
      '+258': 'mz',
      '+260': 'zm',
      '+263': 'zw',
      '+265': 'mw',
      '+261': 'mg',
      '+230': 'mu',
      '+248': 'sc',
      '+269': 'km',
      '+61': 'au',
      '+64': 'nz',
      '+675': 'pg',
      '+679': 'fj',
      '+677': 'sb',
      '+678': 'vu',
      '+685': 'ws',
      '+676': 'to',
      '+686': 'ki',
      '+688': 'tv',
      '+687': 'nc',
      '+689': 'pf',
      '+680': 'pw',
      '+691': 'fm',
      '+692': 'mh',
      '+683': 'nu',
      '+690': 'tk',
    };

    return codeMap[phoneCode] || 'un'; // 'un' as fallback
  };

  const isoCode = getISOCode(countryCode);

  return (
    <img
      src={`https://flagcdn.com/w40/${isoCode}.png`}
      srcSet={`https://flagcdn.com/w80/${isoCode}.png 2x`}
      width="24"
      height="18"
      alt={`${countryCode} flag`}
      className={`inline-block rounded ${className}`}
      onError={(e) => {
        // Fallback to emoji if image fails to load
        const target = e.target as HTMLImageElement;
        target.style.display = 'none';
      }}
    />
  );
}
